<ContentPage
    x:Class="A_Connect.Views.ProfsToPickNewsFeedPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Profs to Pick News Feed"
    xmlns:local="clr-namespace:A_Connect.ViewModels"
    BackgroundColor="White">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 1. Blue Header -->
        <Grid BackgroundColor="#063970" Padding="20,40,20,20">
            <Label Text="Profs to Pick"
                   TextColor="Gold"
                   FontAttributes="Bold"
                   FontSize="24"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>
        </Grid>

        <!-- 2. Main Content -->
        <StackLayout Grid.Row="1" Spacing="15" Padding="20">

            <!-- Search Bar -->
            <Frame CornerRadius="25" BackgroundColor="White" Padding="0">
                <HorizontalStackLayout Padding="10,0">
                    <Image Source="search_icon.png"
                           HeightRequest="20"
                           WidthRequest="20"
                           VerticalOptions="Center"
                           Margin="0,0,5,0"/>
                    <Entry Text="{Binding SearchText, Mode=TwoWay}" 
                           Placeholder="Search"
                           VerticalOptions="Center"
                           FontSize="14"
                           Margin="0"/>
                </HorizontalStackLayout>
            </Frame>

            <!-- ðŸ”¥ Grouped Reviews List -->
            <RefreshView Command="{Binding LoadReviewsCommand}">
                <CollectionView ItemsSource="{Binding GroupedReviews}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <StackLayout Margin="0,10">

                                <!-- ðŸ”¹ Professor Header (Tappable to Expand/Collapse) -->
                                <Frame BackgroundColor="#1F6FB7"
                                       CornerRadius="15"
                                       Padding="15">    
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type local:ProfsToPickNewsFeedViewModel}}, Path=ToggleGroupCommand}"
                                                              CommandParameter="{Binding}" />
                                    </Frame.GestureRecognizers>

                                    <HorizontalStackLayout>
                                        <Label Text="{Binding ProfessorName}"
                                               TextColor="White"
                                               FontSize="18"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"/>

                                        <Label Text="{Binding ReviewCount, StringFormat='({0} Reviews)'}"
                                               TextColor="Gold"
                                               FontSize="14"
                                               FontAttributes="Italic"
                                               VerticalOptions="Center"
                                               Margin="10,0,0,0"/>  
                                    </HorizontalStackLayout>
                                </Frame>


                                <CollectionView ItemsSource="{Binding Reviews}" IsVisible="{Binding IsExpanded}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Frame BackgroundColor="White"
                                                   CornerRadius="10"
                                                   Padding="10"
                                                   Margin="10,0,10,10">
                                                <VerticalStackLayout>
                                                    <Label Text="{Binding CourseCode}" 
                                                           TextColor="Black" 
                                                           FontSize="14" 
                                                           FontAttributes="Bold"/>

                                                    <Label Text="{Binding Content}"
                                                           TextColor="Black"
                                                           FontSize="12"
                                                           MaxLines="2"/>

                                                    <Label Text="{Binding DatePosted, StringFormat='Date: {0:MMMM dd, yyyy}'}"
                                                           TextColor="Gray"
                                                           FontSize="10"
                                                           HorizontalOptions="End"/>
                                                </VerticalStackLayout>
                                            </Frame>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </StackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>

            <!-- "Post a review" button -->
            <Button Text="Post a review +"
                    BackgroundColor="#F1C40F"
                    TextColor="Black"
                    FontAttributes="Bold"
                    CornerRadius="25"
                    HorizontalOptions="Center"
                    Padding="10,5"
                    Clicked="OnPostReviewClicked"/>
        </StackLayout>

        <!-- 3. Bottom Nav Bar -->
        <Grid Grid.Row="2" BackgroundColor="#063970" HeightRequest="60">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ImageButton Source="nav_icon1.png"
                         Grid.Column="0"
                         HorizontalOptions="Center"
                         VerticalOptions="Center"
                         WidthRequest="30" HeightRequest="30"/>
            <ImageButton Source="nav_home.png"
                         Grid.Column="1"
                         HorizontalOptions="Center"
                         VerticalOptions="Center"
                         WidthRequest="30" HeightRequest="30"/>
            <ImageButton Source="nav_profile.png"
                         Grid.Column="2"
                         HorizontalOptions="Center"
                         VerticalOptions="Center"
                         WidthRequest="30" HeightRequest="30"/>
        </Grid>
    </Grid>
</ContentPage>
